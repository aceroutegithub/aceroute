Number.prototype.toUInt=function(){return this<0?this+4294967296:this;};Number.prototype.bytes32=function(){return[(this>>>24)&255,(this>>>16)&255,(this>>>8)&255,this&255];};Number.prototype.bytes16sw=function(){return[this&255,(this>>>8)&255];};Array.prototype.adler32=function(start,len){switch(arguments.length){case 0:start=0;case 1:len=this.length-start;}var a=1,b=0;for(var i=0;i<len;i++){a=(a+this[start+i])%65521;b=(b+a)%65521;}return((b<<16)|a).toUInt();};Array.prototype.crc32=function(start,len){switch(arguments.length){case 0:start=0;case 1:len=this.length-start;}var table=arguments.callee.crctable;if(!table){table=[];var c;for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^(c>>>1):c>>>1;}table[n]=c.toUInt();}arguments.callee.crctable=table;}var c=4294967295;for(var i=0;i<len;i++){c=table[(c^this[start+i])&255]^(c>>>8);}return(c^4294967295).toUInt();};(function(){var toDataURL=function(){var imageData=Array.prototype.slice.call(this.getContext("2d").getImageData(0,0,this.width,this.height).data);var w=this.width;var h=this.height;var stream=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82];Array.prototype.push.apply(stream,w.bytes32());Array.prototype.push.apply(stream,h.bytes32());stream.push(8,6,0,0,0);Array.prototype.push.apply(stream,stream.crc32(12,17).bytes32());var len=h*(w*4+1);for(var y=0;y<h;y++){imageData.splice(y*(w*4+1),0,0);}var blocks=Math.ceil(len/32768);Array.prototype.push.apply(stream,(len+5*blocks+6).bytes32());var crcStart=stream.length;var crcLen=(len+5*blocks+6+4);stream.push(73,68,65,84,120,1);for(var i=0;i<blocks;i++){var blockLen=Math.min(32768,len-(i*32768));stream.push(i==(blocks-1)?1:0);Array.prototype.push.apply(stream,blockLen.bytes16sw());Array.prototype.push.apply(stream,(~blockLen).bytes16sw());var id=imageData.slice(i*32768,i*32768+blockLen);Array.prototype.push.apply(stream,id);}Array.prototype.push.apply(stream,imageData.adler32().bytes32());Array.prototype.push.apply(stream,stream.crc32(crcStart,crcLen).bytes32());stream.push(0,0,0,0,73,69,78,68);Array.prototype.push.apply(stream,stream.crc32(stream.length-4,4).bytes32());return"data:image/png;base64,"+btoa(stream.map(function(c){return String.fromCharCode(c);}).join(""));};var tdu=HTMLCanvasElement.prototype.toDataURL;HTMLCanvasElement.prototype.toDataURL=function(type){var res=tdu.apply(this,arguments);if(res=="data:,"){HTMLCanvasElement.prototype.toDataURL=toDataURL;return this.toDataURL();}else{HTMLCanvasElement.prototype.toDataURL=tdu;return res;}};})();